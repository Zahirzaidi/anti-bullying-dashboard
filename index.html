<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Anti-Bullying Dashboard</title>

<style>
body{
  font-family: Arial;
  background:#f2f2f2;
  text-align:center;
}

h1{
  background:#1e88e5;
  color:white;
  padding:15px;
}

button{
  padding:12px 25px;
  font-size:16px;
  border:none;
  border-radius:5px;
  cursor:pointer;
}

#activateBtn{
  background:green;
  color:white;
}

#stopBtn{
  background:red;
  color:white;
  display:none;
}

@keyframes flash{
  0%{background:red;}
  50%{background:white;}
  100%{background:red;}
}

.alert{
  animation:flash 1s infinite;
  color:white;
}

.normal{
  background:#4caf50;
  color:white;
}

li{
  margin:10px auto;
  padding:15px;
  width:320px;
  border-radius:8px;
  font-size:18px;
  list-style:none;
}
</style>
</head>

<body>

<h1>Anti-Bullying Monitor</h1>

<button id="activateBtn" onclick="activateSystem()">ACTIVATE SYSTEM</button>
<br><br>

<button id="stopBtn" onclick="stopAlarm()">STOP ALARM</button>

<audio id="alarmSound" loop>
  <source src="siren.mp3" type="audio/mpeg">
</audio>

<h2>Room Status</h2>
<ul id="roomList"></ul>

<h2>Alert History</h2>
<ul id="historyList"></ul>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase.js"></script>

<script>

let systemActive = false;

function activateSystem(){
  systemActive = true;
  alert("System Activated!");
}

function stopAlarm(){
  alarmSound.pause();
  alarmSound.currentTime = 0;
  document.getElementById("stopBtn").style.display="none";
}

var firebaseConfig = {
  apiKey: "AIzaSyAMstKG96DUKOPbJQZKKssWtHbc4iLtccI",
  authDomain: "antibullyingsystem-95305.firebaseapp.com",
  databaseURL: "https://antibullyingsystem-95305-default-rtdb.firebaseio.com",
  projectId: "antibullyingsystem-95305",
  storageBucket: "antibullyingsystem-95305.firebasestorage.app",
  messagingSenderId: "808658741708",
  appId: "1:808658741708:web:fa50c6a83341e26bc6d569"
};

firebase.initializeApp(firebaseConfig);

var database = firebase.database();
var roomList = document.getElementById("roomList");
var historyList = document.getElementById("historyList");
var alarmSound = document.getElementById("alarmSound");

database.ref("rooms").on("value", function(snapshot){

  roomList.innerHTML = "";

  snapshot.forEach(function(childSnapshot){

    var room = childSnapshot.key;
    var status = childSnapshot.val().status;

    var now = new Date();
    var time = now.toLocaleTimeString();

    var li = document.createElement("li");
    li.innerText = room + " - " + status + " - " + time;

    if(status == "ALERT"){
      li.classList.add("alert");

      if(systemActive){
        alarmSound.play();
        document.getElementById("stopBtn").style.display="inline";
      }

      // SAVE TO HISTORY
      database.ref("history").push({
        room: room,
        status: status,
        time: now.toLocaleTimeString(),
        date: now.toLocaleDateString()
      });

    }else{
      li.classList.add("normal");
    }

    roomList.appendChild(li);

  });

});

database.ref("history").on("value", function(snapshot){

  historyList.innerHTML = "";

  snapshot.forEach(function(child){

    var data = child.val();

    var li = document.createElement("li");
    li.innerText =
      data.room + " | " +
      data.status + " | " +
      data.time + " | " +
      data.date;

    historyList.appendChild(li);

  });

});

</script>

</body>
</html>
